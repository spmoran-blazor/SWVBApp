@page "/"
@page "/{Action}"
@attribute [Authorize]
@using System.Security.Claims
@using entities = WVBApp.Shared.Entities
@using System.Runtime.Serialization
@using System.Runtime.Serialization.Json
@using System.Text.Json
@using WVBApp.Shared.Services.Data
@using WVBApp.Shared.Services.State
@using WVBApp.Shared
@using MudBlazor

@inject DataAccessService dataAccess
@inject StateAccessService stateAccess


<Client.Components.ProjectAuthComponent CurrentMember="@CurrentMember" />

@if (CurrentMember is not null)
{
    <Client.Components.TopAppBar Action="@Action" />
}

@if (CurrentMember is not null)
{
    switch (Action)
    {
        case null:
            <Client.Components.Messages />
            break;
        case "0":
            <Client.Components.Messages />
            break;
        case "1":
            <Client.Components.EventRegister />
            break;
        case "2":
            <Client.Components.Profile />
            break;
        case "3":
            <Client.Components.EventCreate />
            break;
        default:
            <Client.Components.Messages />
            break;
    }
}
<Client.Components.BottomAppBar />

@code {
    [Parameter]
    public string? Action { get; set; }
    private entities.Member _currentMember = new entities.Member();
    public Member? CurrentMember { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
    }

    protected override async Task OnInitializedAsync()
    {
        stateAccess.OnStateChange += StateHasChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            if(CurrentMember is null)
            {
                CurrentMember = stateAccess.Member;
                StateHasChanged();
            }
        }
    }
}
