@page "/profile"
@attribute [Authorize]
@using System.Net.Http
@using System.Net.Http.Json
@using System.Threading.Tasks
@using Microsoft.AspNetCore.Http
@using System.Security.Claims
@using System.Text.Json
@using WVBApp.Shared.Entities
@using System.Runtime.Serialization
@using System.Runtime.Serialization.Json
@using WVBApp.Shared.Data

@inject AuthenticationStateProvider AuthenticationStateProvider
@inject DataAccessService dataAccess;

@code {
    [CascadingParameter] private Task<AuthenticationState> authenticationStateTask { get; set; }
    private Member _currentMember = new Member();
    private DataAccessService _data;
    private ClaimsPrincipal? _user;
    private int _userId;
    private string? _userEmail;
    //private string? _baseUrl;

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
    }

    protected override async Task OnInitializedAsync()
    {
        _data = dataAccess;
        await GetClaimsPrincipalData();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            await GetMemberByEmail();
        }
    }

    private async Task GetMemberByEmail()
    {
        _currentMember = await dataAccess.GetMemberByEmail(_userEmail);

        var foo = "x";

    }

    private async Task GetClaimsPrincipalData()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User ?? null;

        if (user != null)
        {
            if (user.Identity.IsAuthenticated)
            {
                _userEmail = user.Identity.Name;
            }
        }
    }
}

